#!/bin/sh

<%=
    FB::Helpers::commentify(
      'This tmpwatch cron was generated by chef. To make' +
      ' additions, see fb_tmpclean/README.md'
    )
%>
<% tmpclean = node['fb_tmpclean'].to_hash %>
<% topt = tmpclean['timestamptype'] == 'atime' ? '-u' : '-m' %>
<% remove_special_files = tmpclean['remove_special_files'] ? '-a' : '' %>

for d in /var/{cache/man,catman}/{cat?,X11R6/cat?,local/cat?}; do
    if [ -d "$d" ]; then
        /usr/sbin/tmpwatch -f <%= topt %> <%= tmpclean['default_files'] %> "$d"
    fi
done

<% tmpclean['directories'].each do |dir, time| %>
<%   excludes = [] %>
<%   tmpclean['excludes'].each do |exclude| %>
<%     excludes << "-X '#{dir}/#{exclude}'" %>
<%   end %>
<%   opts = "#{topt} #{time} #{remove_special_files} #{dir}" %>
/usr/sbin/tmpwatch <%= excludes.join(' ') %> -f <%= opts %>
<% end %>

<% tmpclean['extra_lines'].each do |line| %>
<%=  line %>
<% end %>

fb_letsencrypt Cookbook
=======================

Requirements
------------
For RHEL or CentOS Stream, EPEL must be already setup.

Attributes
----------
* node['fb_letsencrypt']['manage_packages']
* node['fb_letsencrypt']['certbot_plugins']
* node['fb_letsencrypt']['enable_package_timer']

Usage
-----
### Managing packages

By default, this cookbook will manage certbot-related packages. If you do not
want this, set `node['fb_letsencrypt']['manage_packages']` to `false`.

This cookbook will install both certbot itself as well as any plugin packages
specified in `node['fb_letsencrypt']['certbot_plugins']`, which should only
include the name of the plugin, not the name of the package.  For example:

```ruby
node.default['fb_letsencrypt']['certbot_plugins'] += [
  'apache',
  'dns-cloudflare',
]
```

### Renewal Timers

The certbot package includes a system timer to renew certificates, which we
will keep enabled, by default. If you prefer to manage your own method of
running reneals, you can set `node['fb_letsencrypt']['enable_package_timer']`
to `false`, and this cookbook will disable it so that you may do whatever you
like instead.

### Renewal Configuration

The configuration files for certificate renewals - while human-editable, are
meant to be generated by initial certificate generation. As such we do not
generate or manage them.

### Helper functions

This cookbook includes various helper functions to make it easy to reference
your LetsEncrypt certificates from other cookbooks and to follow best
practices.

#### FB::LetsEncrypt.cert(node, name)

This method returns the path you should use for the certificate in your
service. It actually returns the `fullchain.pem` which is what you should pass
to 'certificate' configuration for your service in nearly all cases.

This method is also aliased as `certificate` and `fullchain`, should you prefer
those.

#### FB::LetsEncrypt.privkey(node, name)

This method returns the path to the private key. It is aliased as `privatekey`
if you prefer.

#### FB::LetsEncrypt.minimal_cert(node, name)

In the event you really want just the leaf certificate, you can call
`minimal_cert` and it will return the path to `cert.pem`. Note that this is
dangerous and will likely lead to certificate validation errors for your
service.

#### FB::LetsEncrypt.onlychain(node, name)

This method returns the path to `chain.pem`. This is rarely needed.
